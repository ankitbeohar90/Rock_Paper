sqlA=select production_unit_id,batch_id,sum(v1.paper) paper_produced,sum(v1.rock) rock_produced,sum(v1.scissor) scissor_produced,sum(v2.paper) paper_discarded,sum(v2.rock) rock_discarded,sum(v2.scissor) scissor_discarded,sum(v1.paper+v1.rock+v1.scissor) as total_item_produced,sum(v2.paper+v2.rock+v2.scissor) as total_item_discarded from productionData  LATERAL VIEW json_tuple(productionData.items_produced,"paper","rock","scissor") v1 as paper,rock,scissor LATERAL VIEW json_tuple(productionData.items_discarded,"paper","rock","scissor") v2 as paper,rock,scissor group by production_unit_id,batch_id
sqlB=select tabA.invoice_id,tabA.batch_id,sum(case when tabA.defective_items='paper' then tabA.c0 else 0 end) paper,sum(case when tabA.defective_items='rock' then tabA.c0 else 0 end) rock,sum(case when tabA.defective_items='scissor' then tabA.c0 else 0 end) scissor from (select a.invoice_id,a.batch_id,b.defective_items,json_tuple(items_summary, b.defective_items) from salesData a,complaintData b where a.invoice_id=b.invoice_id) tabA group by tabA.invoice_id,tabA.batch_id
metricsql1=select a.batch_id,a.production_unit_id,round(((sum(b.paper+a.paper_discarded)/sum(a.paper_produced))*100),2) paper_discarded_percentage,round(((sum(b.rock+a.rock_discarded)/sum(a.rock_produced))*100),2) rock_discarded_percentage,round(((sum(b.scissor+a.scissor_discarded)/sum(a.scissor_produced))*100),2) scissor_discarded_percentage from deriveProductionDataDf a,deriveSalesComplaintDf b where a.batch_id=b.batch_id group by a.batch_id,a.production_unit_id
metricsql2=select a.production_unit_id,round((((sum(b.paper+b.rock+b.scissor)+sum(a.total_item_discarded)))/sum(a.total_item_produced))*100) as total_item_discarded_percentage from deriveProductionDataDf a,deriveSalesComplaintDf b where a.batch_id=b.batch_id group by a.production_unit_id having total_item_discarded_percentage>20
metricsql3=select a.production_unit_id,round(((sum(a.total_item_discarded)/sum(a.total_item_produced))*100),2) as qa_detected_discarded  from deriveProductionDataDf a group by a.production_unit_id